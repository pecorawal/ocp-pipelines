apiVersion: tekton.dev/v1
kind: Task
metadata:
  name: fetch-repository
  namespace: clouds-build
spec:
  params:
    - name: URL
      value: $(params.GIT_REPO)
    - name: REVISION
      value: $(params.GIT_REVISION)
    - name: SUBDIRECTORY
      value: ''
    - name: DELETE_EXISTING
      value: 'true'

  workspaces:
    - name: source
      description: O workspace onde o código-fonte será clonado.
  
  results:
    - name: commit-sha
      description: O SHA completo do commit que foi clonado.

  volumes:
    - name: git-credentials-volume
      secret:
        secretName: git-credentials

  steps:
    - name: fetch-repository
      params:
        - name: URL
          value: $(params.GIT_REPO)
        - name: REVISION
          value: $(params.GIT_REVISION)
        - name: SUBDIRECTORY
          value: ''
        - name: DELETE_EXISTING
          value: 'true'
      taskRef:
        params:
          - name: kind
            value: task
          - name: name
            value: git-clone
          - name: namespace
            value: openshift-pipelines
        resolver: cluster
